<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Recipe - Trung_cooKING</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>â• Add New Recipe</h1>
      <p>Create your own delicious recipe</p>
    </header>

    <section class="content">
      <div class="card">
        <h3>Recipe Information</h3>
        <form id="recipeForm">
          <div class="form-group">
            <label for="recipeName">Recipe Name</label>
            <input
              type="text"
              id="recipeName"
              name="recipeName"
              placeholder="Enter recipe name"
              required
            />
          </div>

          <div class="form-group">
            <label for="recipeCategory">Category</label>
            <select id="recipeCategory" name="recipeCategory" required>
              <option value="">Select category</option>
              <option value="breakfast">ğŸ³ Breakfast</option>
              <option value="lunch">ğŸ¥ª Lunch</option>
              <option value="dinner">ğŸ Dinner</option>
            </select>
          </div>

          <div class="form-group">
            <label for="recipeDescription">Description</label>
            <textarea
              id="recipeDescription"
              name="recipeDescription"
              placeholder="Brief description of your recipe"
              rows="3"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="prepTime">Prep Time</label>
            <input
              type="text"
              id="prepTime"
              name="prepTime"
              placeholder="e.g., 15 mins"
            />
          </div>

          <div class="form-group">
            <label for="servings">Servings</label>
            <input
              type="number"
              id="servings"
              name="servings"
              placeholder="Number of servings"
              min="1"
            />
          </div>
        </form>
      </div>

      <div class="card">
        <h3>Ingredients</h3>
        <div id="ingredientsList">
          <div class="ingredient-item">
            <input
              type="text"
              placeholder="Ingredient 1"
              class="ingredient-input"
            />
            <button
              type="button"
              class="remove-btn"
              onclick="removeIngredient(this)"
            >
              âœ•
            </button>
          </div>
        </div>
        <button
          type="button"
          class="add-ingredient-btn"
          onclick="addIngredient()"
        >
          + Add Ingredient
        </button>
      </div>

      <div class="card">
        <h3>Instructions</h3>
        <div id="instructionsList">
          <div class="instruction-item">
            <span class="step-number">1</span>
            <textarea placeholder="Step 1" class="instruction-input"></textarea>
            <button
              type="button"
              class="remove-btn"
              onclick="removeInstruction(this)"
            >
              âœ•
            </button>
          </div>
        </div>
        <button
          type="button"
          class="add-instruction-btn"
          onclick="addInstruction()"
        >
          + Add Step
        </button>
      </div>

      <div class="card">
        <button type="submit" form="recipeForm" class="save-btn">
          ğŸ’¾ Save Recipe
        </button>
        <button
          type="button"
          class="cancel-btn"
          onclick="window.location.href = 'index.html'"
        >
          Cancel
        </button>
      </div>
    </section>

    <nav class="bottom-nav">
      <a href="breakfast.html">
        <span class="nav-icon">ğŸ³</span>
        <span>Breakfast</span>
      </a>
      <a href="lunch.html">
        <span class="nav-icon">ğŸ¥ª</span>
        <span>Lunch</span>
      </a>
      <a href="index.html">
        <span class="nav-icon home-icon">ğŸ </span>
        <span>Home</span>
      </a>
      <a href="dinner.html">
        <span class="nav-icon">ğŸ</span>
        <span>Dinner</span>
      </a>
      <a href="add.html" class="active">
        <span class="nav-icon">â•</span>
        <span>Add</span>
      </a>
    </nav>

    <script>
      let ingredientCount = 1;
      let instructionCount = 1;
      let editingRecipeId = null;

      // Check if we're editing an existing recipe
      function checkEditMode() {
        const urlParams = new URLSearchParams(window.location.search);
        editingRecipeId = urlParams.get("edit");

        if (editingRecipeId) {
          loadRecipeForEdit(editingRecipeId);
          document.querySelector("header h1").textContent = "âœï¸ Edit Recipe";
          document.querySelector("header p").textContent = "Update your recipe";
          document.querySelector(".save-btn").textContent = "ğŸ’¾ Update Recipe";
        }
      }

      // Load recipe data for editing
      function loadRecipeForEdit(recipeId) {
        const recipes = JSON.parse(localStorage.getItem("recipes") || "[]");
        const recipe = recipes.find((r) => r.id === recipeId);

        if (recipe) {
          document.getElementById("recipeName").value = recipe.name || "";
          document.getElementById("recipeCategory").value =
            recipe.category || "";
          document.getElementById("recipeDescription").value =
            recipe.description || "";
          document.getElementById("prepTime").value = recipe.prepTime || "";
          document.getElementById("servings").value = recipe.servings || "";

          // Load ingredients
          if (recipe.ingredients && recipe.ingredients.length > 0) {
            const ingredientsList = document.getElementById("ingredientsList");
            ingredientsList.innerHTML = "";
            recipe.ingredients.forEach((ingredient, index) => {
              addIngredient(ingredient);
            });
          }

          // Load instructions
          if (recipe.instructions && recipe.instructions.length > 0) {
            const instructionsList =
              document.getElementById("instructionsList");
            instructionsList.innerHTML = "";
            recipe.instructions.forEach((instruction, index) => {
              addInstruction(instruction);
            });
          }
        }
      }

      function addIngredient(value = "") {
        ingredientCount++;
        const ingredientsList = document.getElementById("ingredientsList");
        const newIngredient = document.createElement("div");
        newIngredient.className = "ingredient-item";
        newIngredient.innerHTML = `
    <input type="text" placeholder="Ingredient ${ingredientCount}" class="ingredient-input" value="${value}">
    <button type="button" class="remove-btn" onclick="removeIngredient(this)">âœ•</button>
  `;
        ingredientsList.appendChild(newIngredient);
      }

      function removeIngredient(button) {
        const ingredientItems = document.querySelectorAll(".ingredient-item");
        if (ingredientItems.length > 1) {
          button.parentElement.remove();
          updateIngredientPlaceholders();
        }
      }

      function updateIngredientPlaceholders() {
        const ingredientInputs = document.querySelectorAll(".ingredient-input");
        ingredientInputs.forEach((input, index) => {
          input.placeholder = `Ingredient ${index + 1}`;
        });
        ingredientCount = ingredientInputs.length;
      }

      function addInstruction(value = "") {
        instructionCount++;
        const instructionsList = document.getElementById("instructionsList");
        const newInstruction = document.createElement("div");
        newInstruction.className = "instruction-item";
        newInstruction.innerHTML = `
    <span class="step-number">${instructionCount}</span>
    <textarea placeholder="Step ${instructionCount}" class="instruction-input">${value}</textarea>
    <button type="button" class="remove-btn" onclick="removeInstruction(this)">âœ•</button>
  `;
        instructionsList.appendChild(newInstruction);
      }

      function removeInstruction(button) {
        const instructionItems = document.querySelectorAll(".instruction-item");
        if (instructionItems.length > 1) {
          button.parentElement.remove();
          updateInstructionNumbers();
        }
      }

      function updateInstructionNumbers() {
        const instructionItems = document.querySelectorAll(".instruction-item");
        instructionItems.forEach((item, index) => {
          const stepNumber = item.querySelector(".step-number");
          const instructionInput = item.querySelector(".instruction-input");
          stepNumber.textContent = index + 1;
          instructionInput.placeholder = `Step ${index + 1}`;
        });
        instructionCount = instructionItems.length;
      }

      // Handle form submission
      document
        .getElementById("recipeForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Collect form data
          const formData = {
            id: editingRecipeId || "recipe_" + Date.now(),
            name: document.getElementById("recipeName").value,
            category: document.getElementById("recipeCategory").value,
            description: document.getElementById("recipeDescription").value,
            prepTime: document.getElementById("prepTime").value,
            servings: document.getElementById("servings").value,
            ingredients: Array.from(
              document.querySelectorAll(".ingredient-input"),
            )
              .map((input) => input.value)
              .filter((value) => value.trim() !== ""),
            instructions: Array.from(
              document.querySelectorAll(".instruction-input"),
            )
              .map((input) => input.value)
              .filter((value) => value.trim() !== ""),
            rating: 0,
            createdAt: editingRecipeId
              ? new Date().toISOString()
              : new Date().toISOString(),
            updatedAt: new Date().toISOString(),
          };

          // Get existing recipes
          const recipes = JSON.parse(localStorage.getItem("recipes") || "[]");

          if (editingRecipeId) {
            // Update existing recipe
            const index = recipes.findIndex((r) => r.id === editingRecipeId);
            if (index !== -1) {
              recipes[index] = {
                ...recipes[index],
                ...formData,
                updatedAt: new Date().toISOString(),
              };
            }
            alert("Recipe updated successfully! ğŸ‰");
          } else {
            // Add new recipe
            recipes.push(formData);
            alert("Recipe saved successfully! ğŸ‰");
          }

          // Save to localStorage
          localStorage.setItem("recipes", JSON.stringify(recipes));

          // Redirect to appropriate category page
          const categoryPages = {
            breakfast: "breakfast.html",
            lunch: "lunch.html",
            dinner: "dinner.html",
          };

          const redirectPage = categoryPages[formData.category] || "index.html";
          window.location.href = redirectPage;
        });

      // Initialize edit mode on page load
      window.addEventListener("load", checkEditMode);
    </script>
  </body>
</html>
